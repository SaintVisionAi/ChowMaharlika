====================================================================
üöÄ COPY THIS SQL AND PASTE INTO SUPABASE DASHBOARD
====================================================================

The Supabase SQL Editor should be open in your browser now at:
https://supabase.com/dashboard/project/yzoochyyhanxslqwzyga/sql

STEPS:
1. In the Supabase dashboard, click "New Query"
2. Copy EVERYTHING below this line (scroll to the bottom!)
3. Paste it into the query editor
4. Click "Run" button (or press Cmd+Enter)
5. You should see: "Success. No rows returned"

====================================================================
üìã START COPYING FROM HERE ‚¨áÔ∏è
====================================================================

-- Migration: Optimize Product Images
-- Description: Ensure image_url column exists with proper defaults and indexes
-- Date: 2025-01-07

-- Ensure image_url column exists on products table
DO $$ 
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'products' AND column_name = 'image_url'
    ) THEN
        ALTER TABLE products ADD COLUMN image_url TEXT;
        COMMENT ON COLUMN products.image_url IS 'URL to product image (Unsplash, Clover, or custom)';
    END IF;
END $$;

-- Add index for faster image queries
CREATE INDEX IF NOT EXISTS idx_products_image_url 
ON products(image_url) 
WHERE image_url IS NOT NULL;

-- Add index for category-based queries (used for category image fallbacks)
CREATE INDEX IF NOT EXISTS idx_products_category 
ON products(category);

-- Add composite index for common queries
CREATE INDEX IF NOT EXISTS idx_products_category_available 
ON products(category, is_available);

-- Update statistics for query planner
ANALYZE products;

-- Grant necessary permissions
GRANT SELECT ON products TO anon, authenticated;
GRANT UPDATE (image_url) ON products TO authenticated;

-- Add helpful view for products without images (for admin dashboard)
CREATE OR REPLACE VIEW products_without_images AS
SELECT 
    id,
    name,
    category,
    price,
    stock_quantity,
    is_available,
    created_at
FROM products
WHERE image_url IS NULL OR image_url LIKE '%placeholder%'
ORDER BY category, name;

GRANT SELECT ON products_without_images TO authenticated;

COMMENT ON VIEW products_without_images IS 'Products that need image generation';

====================================================================
üìã STOP COPYING HERE ‚¨ÜÔ∏è
====================================================================

After running:
‚úÖ You should see "Success. No rows returned"
‚úÖ No errors should appear

To verify it worked:
1. Go to "Table Editor" ‚Üí "products" ‚Üí Check for "image_url" column
2. Go to "Database" ‚Üí "Views" ‚Üí Look for "products_without_images"
3. Run this verification query:

SELECT indexname FROM pg_indexes 
WHERE tablename = 'products' 
AND indexname LIKE 'idx_products_%';

You should see 3 indexes listed!

üéâ Once done, your app is 100% ready for production!
